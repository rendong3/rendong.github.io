<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>服务器管理平台（6）- Utils | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Utils 本篇为服务器管理平台的结篇，讲述一些必要的Util，如钉钉告警、安全加密、远程登录等功能的实现  1、钉钉告警1.1、SQL配置告警规则 逻辑磁盘容量已使用比例超过90%  超过30天未登录            字段名称 字段类型 解释   Id int 自增ID   Table string 监测表名   Metric string 监测指标   Template string 告">
<meta property="og:type" content="article">
<meta property="og:title" content="服务器管理平台（6）- Utils">
<meta property="og:url" content="https://rendong3.github.io/2023/12/14/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%EF%BC%886%EF%BC%89-%20Utils/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Utils 本篇为服务器管理平台的结篇，讲述一些必要的Util，如钉钉告警、安全加密、远程登录等功能的实现  1、钉钉告警1.1、SQL配置告警规则 逻辑磁盘容量已使用比例超过90%  超过30天未登录            字段名称 字段类型 解释   Id int 自增ID   Table string 监测表名   Metric string 监测指标   Template string 告">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://files.mdnice.com/user/17335/e0c85da8-e16e-4436-ae43-a996312eed46.png">
<meta property="og:image" content="https://files.mdnice.com/user/17335/049f30fc-6e24-495a-89c4-42fa29568d14.png">
<meta property="og:image" content="https://files.mdnice.com/user/17335/fe427fd0-fdc9-42d6-a6e5-a897fa2c720f.png">
<meta property="og:image" content="https://files.mdnice.com/user/17335/be9e298a-a9c3-4660-8848-ad38239bd1b4.png">
<meta property="og:image" content="https://files.mdnice.com/user/17335/d74ef8ef-f9e5-47f3-ab0f-1406aa0ffe50.png">
<meta property="article:published_time" content="2023-12-14T05:08:13.000Z">
<meta property="article:modified_time" content="2024-02-06T05:20:57.954Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="服务器管理平台">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://files.mdnice.com/user/17335/e0c85da8-e16e-4436-ae43-a996312eed46.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://rendong3.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-服务器管理平台（6）- Utils" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/14/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%EF%BC%886%EF%BC%89-%20Utils/" class="article-date">
  <time class="dt-published" datetime="2023-12-14T05:08:13.000Z" itemprop="datePublished">2023-12-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      服务器管理平台（6）- Utils
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Utils"><a href="#Utils" class="headerlink" title="Utils"></a>Utils</h1><ul>
<li>本篇为服务器管理平台的结篇，讲述一些必要的Util，如钉钉告警、安全加密、远程登录等功能的实现</li>
</ul>
<h2 id="1、钉钉告警"><a href="#1、钉钉告警" class="headerlink" title="1、钉钉告警"></a>1、钉钉告警</h2><h3 id="1-1、SQL配置告警规则"><a href="#1-1、SQL配置告警规则" class="headerlink" title="1.1、SQL配置告警规则"></a>1.1、SQL配置告警规则</h3><ol>
<li><p>逻辑磁盘容量已使用比例超过90%</p>
</li>
<li><p>超过30天未登录</p>
</li>
</ol>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>字段名称</td>
<td>字段类型</td>
<td>解释</td>
</tr>
<tr>
<td>Id</td>
<td>int</td>
<td>自增ID</td>
</tr>
<tr>
<td>Table</td>
<td>string</td>
<td>监测表名</td>
</tr>
<tr>
<td>Metric</td>
<td>string</td>
<td>监测指标</td>
</tr>
<tr>
<td>Template</td>
<td>string</td>
<td>告警模版</td>
</tr>
<tr>
<td>Frequency</td>
<td>string</td>
<td>告警频率</td>
</tr>
<tr>
<td>Threshold</td>
<td>string</td>
<td>指标阈值</td>
</tr>
<tr>
<td>CreatedAt</td>
<td>timestamp</td>
<td>创建时间</td>
</tr>
<tr>
<td>UpdatedAt</td>
<td>timestamp</td>
<td>修改时间</td>
</tr>
</tbody></table>
<h3 id="1-2、Shell定时轮询"><a href="#1-2、Shell定时轮询" class="headerlink" title="1.2、Shell定时轮询"></a>1.2、Shell定时轮询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 打开定时任务配置文件</span></span></span><br><span class="line"></span><br><span class="line">crontab -e</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 指定每个工作日上午11:10定时执行脚本，并把执行脚本的日志写入文件 result.log</span></span></span><br><span class="line"></span><br><span class="line">10 11 * * 1,2,3,4,5 sh [alert.sh](http://alert.sh) &gt; result.log</span><br></pre></td></tr></table></figure>

<h3 id="1-3、核心功能函数"><a href="#1-3、核心功能函数" class="headerlink" title="1.3、核心功能函数"></a>1.3、核心功能函数</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> openUrl = <span class="string">&quot;https://oapi.dingtalk.com/robot/send?access_token=43e4ad2bcbbef692c7652b9eecca6fd51a0db9e544edcb579640e78f71259006&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NotifyHandler NotifyHandler</span></span><br><span class="line"><span class="keyword">type</span> NotifyHandler <span class="keyword">struct</span> &#123;</span><br><span class="line">	web.BaseHandler</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// POST method</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(NotifyHandler)</span></span> POST(ctx *web.Context) &#123;</span><br><span class="line">	<span class="comment">//1.根据POST表单拼接SQL</span></span><br><span class="line">	<span class="keyword">var</span> rules []model.AlertRule</span><br><span class="line">	rules, err := model.GetRules()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		ctx.JSON(<span class="string">&quot;Describe AlertRule&quot;</span>, <span class="number">101</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//2. 查询记录匹配告警模版</span></span><br><span class="line">	<span class="keyword">for</span> _, rule := <span class="keyword">range</span> rules &#123;</span><br><span class="line">		<span class="keyword">switch</span> rule.Table &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;es_logicaldisk&quot;</span>:</span><br><span class="line">			threshold, err := strconv.Atoi(rule.Threshold)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				ctx.JSON(<span class="string">&quot;Describe AlertRule Threshold ,table es_logicaldisk&quot;</span>, <span class="number">101</span>, err)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			disks, err := model.GetDiskInfo(threshold)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				ctx.JSON(<span class="string">&quot;Describe GetDiskInfo Fail&quot;</span>, <span class="number">101</span>, err)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(disks) != <span class="number">0</span> &#123;</span><br><span class="line">				<span class="keyword">for</span> _, disk := <span class="keyword">range</span> disks &#123;</span><br><span class="line">					alarmStr := fmt.Sprintf(<span class="string">&quot;时间: %s\n告警标题：逻辑磁盘容量超出%v\n业务IP：%v\n序列号:%v\n磁盘：%v使用百分比%v&quot;</span>,</span><br><span class="line">						time.Now().Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>), rule.Threshold, disk.BusinessIp, disk.SN, disk.Filesystem, disk.UsePercent)</span><br><span class="line">					err := notify.SendDingCh(openUrl, alarmStr)</span><br><span class="line">					<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">						ctx.JSON(<span class="string">&quot;Describe LogicalDisk&quot;</span>, <span class="number">101</span>, err)</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;es_logininfo&quot;</span>:</span><br><span class="line">			logins, err := model.GetLoginInfo()</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				ctx.JSON(<span class="string">&quot;Describe GetLoginInfo Fail&quot;</span>, <span class="number">101</span>, err)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(logins) != <span class="number">0</span> &#123;</span><br><span class="line">				<span class="keyword">for</span> _, login := <span class="keyword">range</span> logins &#123;</span><br><span class="line">					alarmStr := fmt.Sprintf(<span class="string">&quot;时间: %s\n告警标题：超过30天未登录\n业务IP：%v\n序列号:%v\n上次登录时间：%v\n,距今间隔：%v&quot;</span>,</span><br><span class="line">						time.Now().Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>), login.BusinessIp, login.SN, login.StartTime, login.Interval)</span><br><span class="line">					err := notify.SendDingCh(openUrl, alarmStr)</span><br><span class="line">					<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">						ctx.JSON(<span class="string">&quot;Describe LoginInfo&quot;</span>, <span class="number">101</span>, err)</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ctx.JSON(fmt.Sprintf(<span class="string">&quot;ALL Alert Info Already send&quot;</span>), <span class="number">0</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="1-4、结果验证"><a href="#1-4、结果验证" class="headerlink" title="1.4、结果验证"></a>1.4、结果验证</h3><p><img src="https://files.mdnice.com/user/17335/e0c85da8-e16e-4436-ae43-a996312eed46.png"></p>
<h2 id="2、数据安全加密"><a href="#2、数据安全加密" class="headerlink" title="2、数据安全加密"></a>2、数据安全加密</h2><h3 id="2-1、Token鉴权"><a href="#2-1、Token鉴权" class="headerlink" title="2.1、Token鉴权"></a>2.1、Token鉴权</h3><ul>
<li>根据web访问来源平台，分配不同Token进行鉴权识别，不同Token标识不同平台，权限不同，如web链接访问无删除权限</li>
</ul>
<p><img src="https://files.mdnice.com/user/17335/049f30fc-6e24-495a-89c4-42fa29568d14.png"></p>
<h3 id="2-2、权限分级及加密存储"><a href="#2-2、权限分级及加密存储" class="headerlink" title="2.2、权限分级及加密存储"></a>2.2、权限分级及加密存储</h3><ul>
<li>平台账户分级，不同权限可访问界面不同<br><img src="https://files.mdnice.com/user/17335/fe427fd0-fdc9-42d6-a6e5-a897fa2c720f.png"></li>
<li>账户密码加密存储<br><img src="https://files.mdnice.com/user/17335/be9e298a-a9c3-4660-8848-ad38239bd1b4.png"></li>
</ul>
<h2 id="3、远程登录"><a href="#3、远程登录" class="headerlink" title="3、远程登录"></a>3、远程登录</h2><h3 id="3-1、Ansible实现"><a href="#3-1、Ansible实现" class="headerlink" title="3.1、Ansible实现"></a>3.1、Ansible实现</h3><ul>
<li>安装<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 安装Ansible</span></span></span><br><span class="line">    yum install -y ansible</span><br><span class="line">    yum install -y sshpass</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 修改配置，忽略告警</span></span></span><br><span class="line">    vim /etc/ansible/ansible.cfg</span><br><span class="line">    </span><br><span class="line">    [defaults]</span><br><span class="line"></span><br><span class="line">host_key_checking = False # 第一次远程ssh主机需要将机器指纹添加到known_hosts，此设置忽略该步骤</span><br><span class="line">    command_warnings=False  #忽略ansible执行命令的告警信息</span><br><span class="line">    deprecation_warnings=False</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 增加test用户组</span></span></span><br><span class="line">    vim /etc/ansible/hosts</span><br><span class="line">    </span><br><span class="line">    [test]</span><br><span class="line">    127.0.0.1 ansible_ssh_user=root ansible_ssh_port=22 ansible_ssh_pass=xxx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 执行命令,验证功能</span></span></span><br><span class="line">  ansible test -m shell -a &#x27;lspci&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 批量机器登录 + 执行shell命令</span></span></span><br><span class="line">1. ip列表写入ip_list.ini</span><br><span class="line">2. 执行脚本</span><br><span class="line">    sh auto_ssh.sh $Password</span><br></pre></td></tr></table></figure></li>
<li>auto_ssh.sh<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">if [ -s ./result.ini ] ; then</span><br><span class="line">    &gt; result.ini</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">Password=$1</span><br><span class="line">sed -i &#x27;/ansible_ssh/d&#x27; /etc/ansible/hosts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加机器信息</span></span><br><span class="line">for Ip in $(cat ip_list.ini)</span><br><span class="line">  do</span><br><span class="line"></span><br><span class="line">      Username=&quot;root&quot;</span><br><span class="line">      echo -e &quot;$Ip ansible_ssh_user=$Username ansible_ssh_port=22 ansible_ssh_pass=$Password&quot; &gt;&gt; /etc/ansible/hosts</span><br><span class="line"></span><br><span class="line">  done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">[<span class="built_in">test</span>]用户组 执行命令</span></span><br><span class="line">ansible test -m shell -a &#x27;lspci&#x27; &gt; result.ini</span><br><span class="line">echo &quot;All Hosts Ansible Done , please check result.ini ! ! !&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-2、Expect实现"><a href="#3-2、Expect实现" class="headerlink" title="3.2、Expect实现"></a>3.2、Expect实现</h3><ul>
<li>安装<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 安装expect</span></span></span><br><span class="line">  yum install -y expect</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 单台机器登录</span></span></span><br><span class="line">  sh login.sh $Ip $Pwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 单台机器登录 + 执行shell命令</span></span></span><br><span class="line">1. 执行命令写入execute_cmd.ini</span><br><span class="line">2. 执行脚本</span><br><span class="line">  sh cmd_login.sh $Ip $Pwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 批量机器登录 + 执行shell命令</span></span></span><br><span class="line">1. ip列表加入ip_list.ini</span><br><span class="line">2. 执行命令写入execute_cmd.ini</span><br><span class="line">3. 执行脚本</span><br><span class="line">sh list_cmd_login.sh $Pwd</span><br></pre></td></tr></table></figure></li>
<li>auto_ssh.sh<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/expect</span></span><br><span class="line"></span><br><span class="line">set user &quot;root&quot;</span><br><span class="line">set host [lindex $argv 0]</span><br><span class="line">set port &quot;22&quot;</span><br><span class="line">set password [lindex $argv 1]</span><br><span class="line"></span><br><span class="line">spawn ssh -p$port $user@$host</span><br><span class="line">expect &#123;</span><br><span class="line">     &quot;*yes/no&quot; &#123; send &quot;yes\r&quot;; exp_continue &#125;</span><br><span class="line">     &quot;*assword:&quot; &#123; send &quot;$&#123;password&#125;\r&quot; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">interact</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><ul>
<li>欢迎关注，感谢支持！</li>
</ul>
<p><img src="https://files.mdnice.com/user/17335/d74ef8ef-f9e5-47f3-ab0f-1406aa0ffe50.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://rendong3.github.io/2023/12/14/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%EF%BC%886%EF%BC%89-%20Utils/" data-id="cls9wmzl3000rmcvhff8m9kpz" data-title="服务器管理平台（6）- Utils" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/" rel="tag">服务器管理平台</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/12/14/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BD%91%E5%8D%A1%E4%BB%8B%E7%BB%8D/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          服务器网卡介绍
        
      </div>
    </a>
  
  
    <a href="/2023/12/14/%E4%B8%80%E6%96%87%E8%AF%BB%E6%87%82%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%A6%E5%A4%96%E7%AE%A1%E7%90%86/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">服务器带外管理</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%A1%E5%88%9B/" rel="tag">信创</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%B8%B8/" rel="tag">日常</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%AE%9E%E4%BE%8B/" rel="tag">日常运维实例</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A1%AC%E4%BB%B6%E7%A7%91%E6%99%AE/" rel="tag">服务器硬件科普</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/" rel="tag">服务器管理平台</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E4%BF%A1%E5%88%9B/" style="font-size: 20px;">信创</a> <a href="/tags/%E6%97%A5%E5%B8%B8/" style="font-size: 10px;">日常</a> <a href="/tags/%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%AE%9E%E4%BE%8B/" style="font-size: 13.33px;">日常运维实例</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A1%AC%E4%BB%B6%E7%A7%91%E6%99%AE/" style="font-size: 20px;">服务器硬件科普</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/" style="font-size: 16.67px;">服务器管理平台</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/02/13/%E9%BE%99%E8%8A%AF--%E8%87%AA%E4%B8%BB%E6%9E%B6%E6%9E%84%E5%85%88%E9%A9%B1%E8%80%85/">龙芯--自主架构先驱者</a>
          </li>
        
          <li>
            <a href="/2024/02/12/%E9%B2%B2%E9%B9%8F--%E5%9E%82%E7%9B%B4%E7%94%9F%E6%80%81%E9%A2%86%E5%AF%BC%E8%80%85/">鲲鹏--垂直生态领导者</a>
          </li>
        
          <li>
            <a href="/2024/02/11/%E9%A3%9E%E8%85%BE--PK%E7%94%9F%E6%80%81%E4%B8%BB%E5%AF%BC%E8%80%85/">飞腾--PK生态主导者</a>
          </li>
        
          <li>
            <a href="/2024/02/10/%E6%B5%B7%E5%85%89-%E6%80%A7%E8%83%BD%E9%A2%86%E5%85%88%E5%AE%9E%E5%B9%B2%E8%80%85/">海光--性能领先实干者</a>
          </li>
        
          <li>
            <a href="/2024/02/09/%E4%BF%A1%E5%88%9B%E5%8F%91%E5%B1%95%E4%B9%8B%E8%B7%AF/">信创发展之路</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>